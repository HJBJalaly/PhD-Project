function [ Q_plus,DQ_plus,V_tib2_plus,F2]=ImpactModel(Q_minus,DQ_minus,L_fem, L_tib, L_torso, Lc_fem, Lc_tib, Lc_torso, M_fem, M_tib, M_torso, XX_fem, XX_tib, XX_torso)

RR=[ 0 1 0 0 0;
     1 0 0 0 0;
     0 0 0 1 0;
     0 0 1 0 0;
     0 0 0 0 1];
Q_plus=RR*Q_minus;

q1=Q_minus(1);
q2=Q_minus(2);
q3=Q_minus(3);
q4=Q_minus(4);
q5=Q_minus(5);

% Impact : A x =B
A =[ XX_fem + XX_tib + 2*L_fem^2*M_fem + L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_fem^2*M_fem + Lc_tib^2*M_tib - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - 2*L_tib*Lc_fem*M_fem*cos(q3),                                                                                                  - L_fem^2*M_tib*cos(q1 - q2) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                     XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3),                                                      - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                               XX_fem + XX_tib + 2*L_fem^2*M_fem + L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_fem^2*M_fem + Lc_tib^2*M_tib - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - L_fem*L_torso*M_torso*cos(q1) - 2*L_tib*Lc_fem*M_fem*cos(q3) + L_fem*Lc_torso*M_torso*cos(q1) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3),                                                                                                                                              2*L_tib*M_fem*cos(q1 + q3 + q5) + 2*L_tib*M_tib*cos(q1 + q3 + q5) + L_tib*M_torso*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q1 + q3 + q5) + 2*L_fem*M_fem*cos(q1 + q5) + L_fem*M_tib*cos(q1 + q5) + L_fem*M_torso*cos(q1 + q5) - Lc_fem*M_fem*cos(q1 + q5),                                                                                                                                              2*L_tib*M_fem*sin(q1 + q3 + q5) + 2*L_tib*M_tib*sin(q1 + q3 + q5) + L_tib*M_torso*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q1 + q3 + q5) + 2*L_fem*M_fem*sin(q1 + q5) + L_fem*M_tib*sin(q1 + q5) + L_fem*M_torso*sin(q1 + q5) - Lc_fem*M_fem*sin(q1 + q5),                                              - L_fem*cos(q1 + q5) - L_tib*cos(q1 + q3 + q5),                                              - L_fem*sin(q1 + q5) - L_tib*sin(q1 + q3 + q5),
    -L_fem^2*M_tib*cos(q1 - q2) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                                                M_tib*L_fem^2 + 2*M_tib*cos(q4)*L_fem*Lc_tib + M_fem*Lc_fem^2 + M_tib*Lc_tib^2 + XX_fem + XX_tib,                                                                                                                                                                                                                                                                                                      - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                    M_tib*Lc_tib^2 + L_fem*M_tib*cos(q4)*Lc_tib + XX_tib,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               XX_fem + XX_tib + L_fem^2*M_tib + Lc_fem^2*M_fem + Lc_tib^2*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 2*L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                                                                                                                            - Lc_tib*M_tib*cos(q2 + q4 + q5) - L_fem*M_tib*cos(q2 + q5) - Lc_fem*M_fem*cos(q2 + q5),                                                                                                                                                                                                                                                                                                            - Lc_tib*M_tib*sin(q2 + q4 + q5) - L_fem*M_tib*sin(q2 + q5) - Lc_fem*M_fem*sin(q2 + q5),                                                L_fem*cos(q2 + q5) + L_tib*cos(q2 + q4 + q5),                                                L_fem*sin(q2 + q5) + L_tib*sin(q2 + q4 + q5),
     XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3),                                                                                                                                                                                                        - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                                                                                                                                          XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib,                                                                                              -L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                                                                                                                                                                                                                                                                                                                 XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3),                                                                                                                                                                                                                                                                                                                   cos(q1 + q3 + q5)*(2*L_tib*M_fem + 2*L_tib*M_tib + L_tib*M_torso - Lc_tib*M_tib),                                                                                                                                                                                                                                                                                                                   sin(q1 + q3 + q5)*(2*L_tib*M_fem + 2*L_tib*M_tib + L_tib*M_torso - Lc_tib*M_tib),                                                                    -L_tib*cos(q1 + q3 + q5),                                                                    -L_tib*sin(q1 + q3 + q5),
    -L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                                                                                                                                                            M_tib*Lc_tib^2 + L_fem*M_tib*cos(q4)*Lc_tib + XX_tib,                                                                                                                                                                                                                                                                                                                                                                                    -L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                 M_tib*Lc_tib^2 + XX_tib,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       XX_tib + Lc_tib^2*M_tib + L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                                                                                                                                                                                                                                                    -Lc_tib*M_tib*cos(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                    -Lc_tib*M_tib*sin(q2 + q4 + q5),                                                                     L_tib*cos(q2 + q4 + q5),                                                                     L_tib*sin(q2 + q4 + q5),
     XX_fem + XX_tib + 2*L_fem^2*M_fem + L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_fem^2*M_fem + Lc_tib^2*M_tib - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - L_fem*L_torso*M_torso*cos(q1) - 2*L_tib*Lc_fem*M_fem*cos(q3) + L_fem*Lc_torso*M_torso*cos(q1) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3), XX_fem + XX_tib + L_fem^2*M_tib + Lc_fem^2*M_fem + Lc_tib^2*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 2*L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3), XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3), XX_tib + Lc_tib^2*M_tib + L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4), 2*XX_fem + 2*XX_tib + XX_torso + 2*L_fem^2*M_fem + 2*L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + L_torso^2*M_torso + 2*Lc_fem^2*M_fem + 2*Lc_tib^2*M_tib + Lc_torso^2*M_torso - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib - 2*L_torso*Lc_torso*M_torso - 2*L_fem^2*M_tib*cos(q1 - q2) + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - 2*L_fem*L_torso*M_torso*cos(q1) - 2*L_tib*Lc_fem*M_fem*cos(q3) + 2*L_fem*Lc_tib*M_tib*cos(q4) + 2*L_fem*Lc_torso*M_torso*cos(q1) - 2*L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - 2*L_fem*Lc_fem*M_fem*cos(q1 - q2) - 2*L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - 2*L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - 2*L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - 2*L_tib*L_torso*M_torso*cos(q1 + q3) + 2*L_tib*Lc_torso*M_torso*cos(q1 + q3), 2*L_tib*M_fem*cos(q1 + q3 + q5) + 2*L_tib*M_tib*cos(q1 + q3 + q5) + L_tib*M_torso*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q2 + q4 + q5) + 2*L_fem*M_fem*cos(q1 + q5) + L_fem*M_tib*cos(q1 + q5) - L_fem*M_tib*cos(q2 + q5) + L_fem*M_torso*cos(q1 + q5) - Lc_fem*M_fem*cos(q1 + q5) - Lc_fem*M_fem*cos(q2 + q5) - L_torso*M_torso*cos(q5) + Lc_torso*M_torso*cos(q5), 2*L_tib*M_fem*sin(q1 + q3 + q5) + 2*L_tib*M_tib*sin(q1 + q3 + q5) + L_tib*M_torso*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q2 + q4 + q5) + 2*L_fem*M_fem*sin(q1 + q5) + L_fem*M_tib*sin(q1 + q5) - L_fem*M_tib*sin(q2 + q5) + L_fem*M_torso*sin(q1 + q5) - Lc_fem*M_fem*sin(q1 + q5) - Lc_fem*M_fem*sin(q2 + q5) - L_torso*M_torso*sin(q5) + Lc_torso*M_torso*sin(q5), L_fem*cos(q2 + q5) - L_fem*cos(q1 + q5) - L_tib*cos(q1 + q3 + q5) + L_tib*cos(q2 + q4 + q5), L_fem*sin(q2 + q5) - L_fem*sin(q1 + q5) - L_tib*sin(q1 + q3 + q5) + L_tib*sin(q2 + q4 + q5),
     2*L_tib*M_fem*cos(q1 + q3 + q5) + 2*L_tib*M_tib*cos(q1 + q3 + q5) + L_tib*M_torso*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q1 + q3 + q5) + 2*L_fem*M_fem*cos(q1 + q5) + L_fem*M_tib*cos(q1 + q5) + L_fem*M_torso*cos(q1 + q5) - Lc_fem*M_fem*cos(q1 + q5),                                                                                                                                                                                                                                         - Lc_tib*M_tib*cos(q2 + q4 + q5) - L_fem*M_tib*cos(q2 + q5) - Lc_fem*M_fem*cos(q2 + q5),                                                                                                                                                                                                                                                                                                                                              cos(q1 + q3 + q5)*(2*L_tib*M_fem + 2*L_tib*M_tib + L_tib*M_torso - Lc_tib*M_tib),                                                                                                         -Lc_tib*M_tib*cos(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                                                                            2*L_tib*M_fem*cos(q1 + q3 + q5) + 2*L_tib*M_tib*cos(q1 + q3 + q5) + L_tib*M_torso*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q2 + q4 + q5) + 2*L_fem*M_fem*cos(q1 + q5) + L_fem*M_tib*cos(q1 + q5) - L_fem*M_tib*cos(q2 + q5) + L_fem*M_torso*cos(q1 + q5) - Lc_fem*M_fem*cos(q1 + q5) - Lc_fem*M_fem*cos(q2 + q5) - L_torso*M_torso*cos(q5) + Lc_torso*M_torso*cos(q5),                                                                                                                                                                                                                                                                                                                                                                        2*M_fem + 2*M_tib + M_torso,                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                          -1,                                                                                           0,
     2*L_tib*M_fem*sin(q1 + q3 + q5) + 2*L_tib*M_tib*sin(q1 + q3 + q5) + L_tib*M_torso*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q1 + q3 + q5) + 2*L_fem*M_fem*sin(q1 + q5) + L_fem*M_tib*sin(q1 + q5) + L_fem*M_torso*sin(q1 + q5) - Lc_fem*M_fem*sin(q1 + q5),                                                                                                                                                                                                                                         - Lc_tib*M_tib*sin(q2 + q4 + q5) - L_fem*M_tib*sin(q2 + q5) - Lc_fem*M_fem*sin(q2 + q5),                                                                                                                                                                                                                                                                                                                                              sin(q1 + q3 + q5)*(2*L_tib*M_fem + 2*L_tib*M_tib + L_tib*M_torso - Lc_tib*M_tib),                                                                                                         -Lc_tib*M_tib*sin(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                                                                            2*L_tib*M_fem*sin(q1 + q3 + q5) + 2*L_tib*M_tib*sin(q1 + q3 + q5) + L_tib*M_torso*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q2 + q4 + q5) + 2*L_fem*M_fem*sin(q1 + q5) + L_fem*M_tib*sin(q1 + q5) - L_fem*M_tib*sin(q2 + q5) + L_fem*M_torso*sin(q1 + q5) - Lc_fem*M_fem*sin(q1 + q5) - Lc_fem*M_fem*sin(q2 + q5) - L_torso*M_torso*sin(q5) + Lc_torso*M_torso*sin(q5),                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                        2*M_fem + 2*M_tib + M_torso,                                                                                           0,                                                                                          -1,
     L_fem*cos(q1 + q5) + L_tib*cos(q1 + q3 + q5),                                                                                                                                                                                                                                                                                  - L_fem*cos(q2 + q5) - L_tib*cos(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                       L_tib*cos(q1 + q3 + q5),                                                                                                                -L_tib*cos(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   L_fem*cos(q1 + q5) - L_fem*cos(q2 + q5) + L_tib*cos(q1 + q3 + q5) - L_tib*cos(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                  1,                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                           0,                                                                                           0,
     L_fem*sin(q1 + q5) + L_tib*sin(q1 + q3 + q5),                                                                                                                                                                                                                                                                                  - L_fem*sin(q2 + q5) - L_tib*sin(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                       L_tib*sin(q1 + q3 + q5),                                                                                                                -L_tib*sin(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   L_fem*sin(q1 + q5) - L_fem*sin(q2 + q5) + L_tib*sin(q1 + q3 + q5) - L_tib*sin(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                                                                                                                                                                                                                                                                                                                                  1,                                                                                           0,                                                                                           0];
 
    

     
B=[                                                                                                                                                                                                                                                                                                                                                                            XX_fem + XX_tib + 2*L_fem^2*M_fem + L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_fem^2*M_fem + Lc_tib^2*M_tib - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - 2*L_tib*Lc_fem*M_fem*cos(q3),                                                                                                  - L_fem^2*M_tib*cos(q1 - q2) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                     XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3),                                                      - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                               XX_fem + XX_tib + 2*L_fem^2*M_fem + L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_fem^2*M_fem + Lc_tib^2*M_tib - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - L_fem*L_torso*M_torso*cos(q1) - 2*L_tib*Lc_fem*M_fem*cos(q3) + L_fem*Lc_torso*M_torso*cos(q1) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - L_fem^2*M_tib*cos(q1 - q2) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                                                M_tib*L_fem^2 + 2*M_tib*cos(q4)*L_fem*Lc_tib + M_fem*Lc_fem^2 + M_tib*Lc_tib^2 + XX_fem + XX_tib,                                                                                                                                                                                                                                                                                                      - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                    M_tib*Lc_tib^2 + L_fem*M_tib*cos(q4)*Lc_tib + XX_tib,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               XX_fem + XX_tib + L_fem^2*M_tib + Lc_fem^2*M_fem + Lc_tib^2*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 2*L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3),                                                                                                                                                                                                        - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3),                                                                                                                                                                                                                                                                                                                          XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib,                                                                                              -L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                                                                                                                                                                                                                                                                                                                 XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                                                                                                                                                                            M_tib*Lc_tib^2 + L_fem*M_tib*cos(q4)*Lc_tib + XX_tib,                                                                                                                                                                                                                                                                                                                                                                                    -L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),                                                                                                                 M_tib*Lc_tib^2 + XX_tib,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       XX_tib + Lc_tib^2*M_tib + L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4),
 XX_fem + XX_tib + 2*L_fem^2*M_fem + L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_fem^2*M_fem + Lc_tib^2*M_tib - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - L_fem*L_torso*M_torso*cos(q1) - 2*L_tib*Lc_fem*M_fem*cos(q3) + L_fem*Lc_torso*M_torso*cos(q1) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3), XX_fem + XX_tib + L_fem^2*M_tib + Lc_fem^2*M_fem + Lc_tib^2*M_tib - L_fem^2*M_tib*cos(q1 - q2) + 2*L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_fem*Lc_fem*M_fem*cos(q1 - q2) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3), XX_tib + 2*L_tib^2*M_fem + 2*L_tib^2*M_tib + L_tib^2*M_torso + Lc_tib^2*M_tib - 2*L_tib*Lc_tib*M_tib + 2*L_fem*L_tib*M_fem*cos(q3) + L_fem*L_tib*M_tib*cos(q3) + L_fem*L_tib*M_torso*cos(q3) - L_tib*Lc_fem*M_fem*cos(q3) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - L_tib*L_torso*M_torso*cos(q1 + q3) + L_tib*Lc_torso*M_torso*cos(q1 + q3), XX_tib + Lc_tib^2*M_tib + L_fem*Lc_tib*M_tib*cos(q4) - L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4), 2*XX_fem + 2*XX_tib + XX_torso + 2*L_fem^2*M_fem + 2*L_fem^2*M_tib + 2*L_tib^2*M_fem + L_fem^2*M_torso + 2*L_tib^2*M_tib + L_tib^2*M_torso + L_torso^2*M_torso + 2*Lc_fem^2*M_fem + 2*Lc_tib^2*M_tib + Lc_torso^2*M_torso - 2*L_fem*Lc_fem*M_fem - 2*L_tib*Lc_tib*M_tib - 2*L_torso*Lc_torso*M_torso - 2*L_fem^2*M_tib*cos(q1 - q2) + 4*L_fem*L_tib*M_fem*cos(q3) + 2*L_fem*L_tib*M_tib*cos(q3) + 2*L_fem*L_tib*M_torso*cos(q3) - 2*L_fem*L_torso*M_torso*cos(q1) - 2*L_tib*Lc_fem*M_fem*cos(q3) + 2*L_fem*Lc_tib*M_tib*cos(q4) + 2*L_fem*Lc_torso*M_torso*cos(q1) - 2*L_fem*Lc_tib*M_tib*cos(q1 - q2 - q4) - 2*L_fem*Lc_fem*M_fem*cos(q1 - q2) - 2*L_tib*Lc_tib*M_tib*cos(q1 - q2 + q3 - q4) - 2*L_fem*L_tib*M_tib*cos(q1 - q2 + q3) - 2*L_tib*Lc_fem*M_fem*cos(q1 - q2 + q3) - 2*L_tib*L_torso*M_torso*cos(q1 + q3) + 2*L_tib*Lc_torso*M_torso*cos(q1 + q3),
                                                                                                                                                                                                                                                                                                                                                                                                                                                           2*L_tib*M_fem*cos(q1 + q3 + q5) + 2*L_tib*M_tib*cos(q1 + q3 + q5) + L_tib*M_torso*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q1 + q3 + q5) + 2*L_fem*M_fem*cos(q1 + q5) + L_fem*M_tib*cos(q1 + q5) + L_fem*M_torso*cos(q1 + q5) - Lc_fem*M_fem*cos(q1 + q5),                                                                                                                                                                                                                                         - Lc_tib*M_tib*cos(q2 + q4 + q5) - L_fem*M_tib*cos(q2 + q5) - Lc_fem*M_fem*cos(q2 + q5),                                                                                                                                                                                                                                                                                                                                              cos(q1 + q3 + q5)*(2*L_tib*M_fem + 2*L_tib*M_tib + L_tib*M_torso - Lc_tib*M_tib),                                                                                                         -Lc_tib*M_tib*cos(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                                                                            2*L_tib*M_fem*cos(q1 + q3 + q5) + 2*L_tib*M_tib*cos(q1 + q3 + q5) + L_tib*M_torso*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q1 + q3 + q5) - Lc_tib*M_tib*cos(q2 + q4 + q5) + 2*L_fem*M_fem*cos(q1 + q5) + L_fem*M_tib*cos(q1 + q5) - L_fem*M_tib*cos(q2 + q5) + L_fem*M_torso*cos(q1 + q5) - Lc_fem*M_fem*cos(q1 + q5) - Lc_fem*M_fem*cos(q2 + q5) - L_torso*M_torso*cos(q5) + Lc_torso*M_torso*cos(q5),
                                                                                                                                                                                                                                                                                                                                                                                                                                                           2*L_tib*M_fem*sin(q1 + q3 + q5) + 2*L_tib*M_tib*sin(q1 + q3 + q5) + L_tib*M_torso*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q1 + q3 + q5) + 2*L_fem*M_fem*sin(q1 + q5) + L_fem*M_tib*sin(q1 + q5) + L_fem*M_torso*sin(q1 + q5) - Lc_fem*M_fem*sin(q1 + q5),                                                                                                                                                                                                                                         - Lc_tib*M_tib*sin(q2 + q4 + q5) - L_fem*M_tib*sin(q2 + q5) - Lc_fem*M_fem*sin(q2 + q5),                                                                                                                                                                                                                                                                                                                                              sin(q1 + q3 + q5)*(2*L_tib*M_fem + 2*L_tib*M_tib + L_tib*M_torso - Lc_tib*M_tib),                                                                                                         -Lc_tib*M_tib*sin(q2 + q4 + q5),                                                                                                                                                                                                                                                                                                                                                                                                                                                            2*L_tib*M_fem*sin(q1 + q3 + q5) + 2*L_tib*M_tib*sin(q1 + q3 + q5) + L_tib*M_torso*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q1 + q3 + q5) - Lc_tib*M_tib*sin(q2 + q4 + q5) + 2*L_fem*M_fem*sin(q1 + q5) + L_fem*M_tib*sin(q1 + q5) - L_fem*M_tib*sin(q2 + q5) + L_fem*M_torso*sin(q1 + q5) - Lc_fem*M_fem*sin(q1 + q5) - Lc_fem*M_fem*sin(q2 + q5) - L_torso*M_torso*sin(q5) + Lc_torso*M_torso*sin(q5),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                               0,                                                                                                                                                                                                                                                                                                                                                                                                                             0,                                                                                                                                       0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0];
ImpactSol=(A\B)*DQ_minus;
F2=ImpactSol(end-1:end);
DQ_plus=[RR zeros(5,2)]*ImpactSol(1:7);
V_tib2_plus=ImpactSol(6:7);

end

